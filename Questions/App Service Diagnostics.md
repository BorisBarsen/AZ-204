# App Service Diagnostics

Question: Which of the following types of application logging is supported on the Linux platform?

- [ ] Web server logging
- [ ] Failed request tracing
- [ ] Detailed Error Messages
- [x] Deployment logging
- [x] Application logging

Answer: Deployment and Application logging are supported on the Linux platform.

---

Question: Which of the following types of application logging supporteds blob storage?

- [x] Web server logging
- [ ] Failed request tracing
- [ ] Detailed Error Messages
- [ ] Deployment logging
- [x] Application logging

Answer: Web server and Application logging are support blob storage.

---

Question: Which of the following statements are true for application logging?

- [ ] You can choose App Service file system or Blob storage logging, but not both
- [x] Only .NET application logs can be written to the blob storage
- [x] You can use other Azure services for logging and monitoring
- [x] App Service file system (Filesystem) will turn itself off in 12 hours
- [ ] Blob storage logging will turn itself off in 12 hours
- [x] Blob storage is for long-term logging
- [ ] App Service file system logging is more detailed than Blob storage logging
- [x] Logs can be reatained for specified amount of days
- [x] For logs stored in the App Service file system, you can download the ZIP file in the browser
- [ ] Filesystem and storage Blob storage are supported for both Windows and Linux apps.

Answer:

- App Service file system logging is temporary logging, Blob storage logging is for long term
- Blob storage is only applicable for Web server and Application logging
- Blob storage logging is more detailed than App Service file system
- Filesystem storage is the only available option for Linux. Windows supports both filesystem and blob storage
- ZIP file of logs is stored at:
  - For Linux/custom containers: `https://<app-name>.scm.azurewebsites.net/api/logs/docker/zip`
  - For Windows apps: `https://<app-name>.scm.azurewebsites.net/api/dump`

---

Question: Imagine you are a developer who needs to set up monitoring for a .NET web application named `myApp` deployed on Microsoft Azure. Your task is to leverage Azure Monitor by creating a Log Analytics workspace within an existing resource group named `myResourceGroup`. After creating the workspace, you need to retrieve the resource ID of the web application and the workspace ID of the newly created Log Analytics workspace. With these IDs, you are then tasked with creating diagnostic settings for the web application to enable Azure Monitor to collect console logs and HTTP logs. How would you perform these tasks using Azure CLI commands?

```ps
# Code here
```

Answer:

```ps
# Create a Log Analytics workspace within the existing resource group named 'myResourceGroup'
az monitor log-analytics workspace create --resource-group myResourceGroup --workspace-name myMonitorWorkspace

# Retrieve the resource ID of the web application named 'myApp'
resourceID=$(az webapp show -g myResourceGroup -n myApp --query id --output tsv)

# Retrieve the workspace ID of the newly created Log Analytics workspace
workspaceID=$(az monitor log-analytics workspace show -g myResourceGroup --workspace-name myMonitorWorkspace --query id --output tsv)

# Create diagnostic settings for the web application to enable Azure Monitor to collect console logs and HTTP logs
az monitor diagnostic-settings create --resource $resourceID \
 --workspace $workspaceID \
 -n myMonitorLogs \
 --logs '[{"category": "AppServiceConsoleLogs", "enabled": true},
  {"category": "AppServiceHTTPLogs", "enabled": true}]'
```

---

Question: How to stream HTTP logs for `myApp` in `myResourceGroup` resource group, using Cloud Shell?

```ps
# Code here
```

Answer:

To filter specific log types, such as HTTP, use the `--Provider` parameter

```ps
az webapp log tail --name myApp --resource-group myResourceGroup --provider http
```

---

Question: You are managing an Azure Subscription named `SubscriptionA`, where an Azure App Service named `myAppService` is deployed and running on a Linux environment. The monitoring team requires access to query logs generated by `myAppService`. How should you configure the system to meet this requirement?

- [ ] Enable `AppServiceAppLogs` under Diagnostics settings and set the destination to send logs to the App Service file system.
- [ ] Enable `AppServiceAppLogs` under Diagnostics settings and set the destination to send logs to a Blob Storage Account.
- [x] Enable `AppServiceAppLogs` under Diagnostics settings and set the destination to send logs to Log Analytics.
- [ ] Enable `AppServiceConsoleLogs` under Diagnostics settings and set the destination to send logs to Log Analytics.
- [ ] Enable `AppServiceConsoleLogs` under Diagnostics settings and set the destination to send logs to a Blob Storage Account.
- [ ] Enable `AppServiceConsoleLogs` under Diagnostics settings and set the destination to send logs to Log Analytics.
- [ ] Enable `AllMetrics` under Diagnostics settings and set the destination to send logs to Log Analytics.
- [ ] Enable `AllMetrics` under Diagnostics settings and set the destination to send logs to a Blob Storage Account.
- [ ] Enable `AllMetrics` under Diagnostics settings and set the destination to send logs to Log Analytics.

Answer: Enable `AppServiceAppLogs` sent to `Log Analytics`.

The `Azure Log Analytics` service provides a platform for comprehensive log management and analytics. By enabling `AppServiceAppLogs` under `Diagnostics` settings and setting the destination to send logs to `Log Analytics`, you allow the monitoring team to query and analyze these logs. The other `AppServiceAppLogs` options, while valid Azure services, do not provide the same level of log querying and analysis capabilities as `Log Analytics`.  
`AppServiceConsoleLogs` is incorrect because it is not the appropriate setting for this requirement.  
`AllMetrics` settings are collected by agents on to the App Service and report the usage of host resources. These are items like CPU usage, memory usage, and disk I/O used.
