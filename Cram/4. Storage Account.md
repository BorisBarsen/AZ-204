# [Storage Account](https://learn.microsoft.com/en-us/azure/storage/common/storage-account-overview)

|              |                                                                                                                                                                                                                                                                                                                                                                        |
| ------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Endpoint:    | `https://<storage-account>.blob.core.windows.net`                                                                                                                                                                                                                                                                                                                      |
| Requires     | [Identity](./2.%20Managed%20identities.md), [Resource Group](./3.%20Resource%20Group.md)                                                                                                                                                                                                                                                                               |
| Provisioning | [az storage account create](https://learn.microsoft.com/en-us/cli/azure/storage/account?view=azure-cli-latest#az-storage-account-create) <br> [New-AzStorageAccount](https://learn.microsoft.com/en-us/powershell/module/az.storage/new-azstorageaccount) <br> [BlobServiceClient](https://learn.microsoft.com/en-us/dotnet/api/azure.storage.blobs.blobserviceclient) |

```sh
az storage account create
    --name # valid DNS name, 3-24 chars
    --resource-group

    # Pricing tiers (<Type>_<Redundancy>)
    # Changing type: Copy to another account.
    # Changing redundancy: Instantly applied
    [--sku {Standard_GRS, Standard_GZRS, Standard_LRS, Standard_RAGRS, Standard_ZRS, Standard_RAGZRS, Premium_LRS, Premium_ZRS}]
    # Type üßä:
    # - Standard: ‚è∫Ô∏è‚≠ê
    # - Premium: ‚ö°üí≤ (SSD). ‚≠ê: using smaller objects
    # Redundancy:
    # - LRS: üè∑Ô∏è, ‚ùå: üôã‚Äç‚ôÇÔ∏è.
    #   ‚≠ê: your application can reconstruct lost data, requires regional replication (perhaps due to governance reasons), or uses Azure unmanaged disks.
    # - ZRS: Data write operations are confirmed successful once all the available zones have received the data. This even includes zones that are temporarily unavailable.
    #   ‚≠ê: üôã‚Äç‚ôÇÔ∏è, regional data replication, Azure Files workloads.
    # - GRS: LRS + async copy to a secondary region.
    # - GZRS: ZRS + async copy to a secondary region. ü¶∫
    # Read Access (RA): üôã‚Äç‚ôÇÔ∏è Allow read-only from `https://{accountName}-secondary.<url>`
    # Failover: manually initialized, swaps primary and secondary regions.
    # - C#: BlobClientOptions.GeoRedundantSecondaryUri (will not attempt again if 404).
    # - Alt: Copy data.
    # - ‚ùå: Azure Files, BlockBlobStorage

    [--access-tier {Cool, Hot, Premium}]
    # - Hot: üí≤‚ö°
    # - Cool: 30-day min. storage, ‚ö°
    # - Premium: Inherited by SKU

    [--kind {BlobStorage, BlockBlobStorage, FileStorage, Storage, StorageV2}]
    # - BlobStorage: Simple blob-only scenarios.
    # - BlockBlobStorage: ‚ö°üíé
    # - FileStorage: High-scale or high IOPS file shares. üíé
    # - Storage (General-purpose v1): Legacy. ‚≠ê: classic deployment model or üèãüèø apps
    # - StorageV2: ‚è∫Ô∏è‚≠ê

    [--dns-endpoint-type {AzureDnsZone, Standard}] # Requires storage-preview extension
    # In one subscription, you can have accounts with both
    # - Standard: 250 accounts (500 with quota increase)
    # - AzureDnsZone: 5000 accounts
    # https://<storage-account>.z[00-50].<storage-service>.core.windows.net
    # Retrieve endpoints: GET https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/{accountName}?api-version=2022-09-01

    # Data and metadata are encryptred by default
    # Use custom provided encryption for greater security
    [--encryption-key-source {Microsoft.Keyvault, Microsoft.Storage}]
    # - Microsoft.Storage: Fully managed by Azure (rotation and access), no control over the encryption keys
    # - Microsoft.Keyvault: Customer managed or Customer provided key (accessible only by you). You manage rotation. Needs a managed identity if using KeyVault access.
    #     [--encryption-key-name]
    #     [--encryption-key-vault] # URL
    #     [--encryption-key-version]
    [--encryption-services {blob, file, queue, table}] # queue / table with customer-managed keys = üí≤
    [--encryption-key-type-for-queue {Account, Service}]
    [--encryption-key-type-for-table {Account, Service}]

    # üßä Optionally encrypt infrastructure with separate Microsoft managed key. StorageV2 or BlockBlobStorage only.
    [--require-infrastructure-encryption {false, true}] # false

    [--enable-hierarchical-namespace {false, true}]
    # Filesystem semantics. StorageV2 only. ‚ùå failover

    [--custom-domain] "<custom-domain-name>" # For static hosting
    [--use-subdomain {false, true}] # Set it to false
    # To enable HTTPS, you'll have to use Azure CDN
```

Redundancy:

| LRS                                                                                                                   | ZRS                                                                                                                | GRS                                                                                                               | GZRS                                                                                                                    |
| --------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| ![LRS](https://learn.microsoft.com/en-us/azure/storage/common/media/storage-redundancy/locally-redundant-storage.png) | ![ZRS](https://learn.microsoft.com/en-us/azure/storage/common/media/storage-redundancy/zone-redundant-storage.png) | ![GRS](https://learn.microsoft.com/en-us/azure/storage/common/media/storage-redundancy/geo-redundant-storage.png) | ![GZRS](https://learn.microsoft.com/en-us/azure/storage/common/media/storage-redundancy/geo-zone-redundant-storage.png) |

Pricing: ‚è´ is not charged.
